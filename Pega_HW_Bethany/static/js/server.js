// const express = require("express");
// const cors = require("cors");
// const { OpenAI } = require("openai");
// require("dotenv").config();

// const app = express();
// const port = 3002;

// app.use(cors());
// app.use(express.json());
const cors = require('cors');
const express = require('express');
const { OpenAI } = require('openai');  // å¼•å…¥ OpenAI å¥—ä»¶
require('dotenv').config();

const app = express();

// ä½¿ç”¨ CORS ä¸­ä»‹è»Ÿé«”
app.use(cors({
  origin: 'http://localhost:3000',  // å…è¨±çš„å‰ç«¯åŸŸå
  methods: ['GET', 'POST'],
  allowedHeaders: ['Content-Type']
}));



// ç›´æŽ¥åœ¨ç¨‹å¼ç¢¼ä¸­å¯«å…¥ API é‡‘é‘°
const openai = new OpenAI({
  apiKey: "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"
});

// å®šç¾©ä½ çš„ API è·¯ç”±
app.post('/api/chat', async (req, res) => {
  const userInput = req.body.message;  // å¾žå‰ç«¯ç²å–ä½¿ç”¨è€…çš„è¨Šæ¯



// ç›´æŽ¥åœ¨ç¨‹å¼ç¢¼ä¸­å¯«å…¥ API é‡‘é‘°
const openai = new OpenAI({
  apiKey: "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"
});


// app.post("/api/v1/chat", async (req, res) => {
//   const userInput = req.body.message;

  // ðŸ”§ ä½ çš„ç³»çµ±æç¤º
  const systemPrompt =  `
  ä½ æ˜¯è‡ªæˆ‘ä»‹ç´¹GPTï¼Œ
  è«‹æ ¹æ“šä½¿ç”¨è€…çš„å•é¡Œç”¨è¦ªåˆ‡ä¸”å°ˆæ¥­çš„æ–¹å¼é€²è¡Œå›žç­”ï¼Œä¾ç…§æˆ‘çµ¦çš„é€™äº›å…§å®¹å›žç­”ï¼Œä¸èƒ½èªªè¬Šã€‚

  æˆ‘æ˜¯æ´ªå¬¿å©·æœ¬äººï¼Œæˆ‘ç¾åœ¨è¦çˆ­å–AIè»Ÿé«”å·¥ç¨‹å¸«çš„è·ä½ï¼Œè«‹ä¾æ“šå•é¡Œæ‰¾å°‹æ‰€æœ‰æˆ‘çµ¦ä½ çš„RAGè³‡æ–™ï¼Œç„¶å¾Œä¾æ“šè³‡æ–™å›žç­”ä¸¦åšè‡ªæˆ‘ä»‹ç´¹ï¼Œä¸è¦äº‚æŽ°ã€‚
  æˆ‘ä»Šå¹´26æ­²ï¼Œå°ä¸­äººï¼Œç›®å‰ä½åœ¨æ¡ƒåœ’å¸‚ä¸­å£¢å€ã€‚
  å€‹æ€§æ´»æ½‘å¤–å‘ã€å–„æ–¼æºé€šã€ç©æ¥µå­¸ç¿’æ–°æŠ€èƒ½ã€‚
  æˆ‘æ˜¯æœ‰ä¸€å¹´ç³»çµ±å» ç¶“é©—çš„è»Ÿé«”å·¥ç¨‹å¸«ï¼Œé›¢è·è£œç¢©å£«å­¸ä½ï¼Œä¸¦å­¸ç¿’AIï¼Œåƒèˆ‡LLMå¯¦ç¿’è¨ˆç•«ã€‚
  æ“…é•·é ˜åŸŸ:æ·±åº¦å­¸ç¿’å½±åƒè¾¨è­˜(Tensorflow)ã€å‰ç«¯ç¶²é é–‹ç™¼(VueJSæž¶æ§‹)ã€è³‡æ–™åº«ç³»çµ±(MS SQLã€Azure)ã€æ•¸æ“šåˆ†æžèˆ‡è¦–è¦ºåŒ–(Pythonã€R)

  åœ¨å°±è®€è¼”ä»å¤§å­¸çµ±è¨ˆè³‡è¨Šç³»æœŸé–“ï¼Œå› ç‚ºå¸Œæœ›èƒ½å¢žåŠ è³‡è¨Šåœ¨å¯¦å‹™ä¸Šçš„æ‡‰ç”¨ï¼Œæ–¼æ˜¯ä¸»å‹•ç”³è«‹ä¼æ¥­å¯¦ç¿’æ©Ÿæœƒï¼Œæ›¾åœ¨è³‡é€šé›»è…¦æ“”ä»»å¯¦ç¿’ç”Ÿï¼Œå¯¦éš›æ“ä½œäº†éŠ€è¡Œç³»çµ±è³‡æ–™åº«èˆ‡ç¶²é é–‹ç™¼ç›¸é—œè»Ÿé«”(SQLã€HTMLç­‰) ï¼ŒæŠŠåœ¨å­¸æ ¡æŽ¥è§¸çš„è»Ÿé«”çœŸçš„åœ¨å¯¦å‹™ä¸Šå‘ˆç¾ï¼Œå¥ å®šäº†æˆ‘æœç¨‹å¼æ’°å¯«ç™¼å±•çš„åŸºç¤Žã€‚
  æˆ‘å°æ–¼ç†è²¡å¾ˆæœ‰èˆˆè¶£ï¼Œå› æ­¤å¤§å­¸å°ˆé¡Œç™¼è¡¨çš„ä¸»é¡Œç‚ºã€Šé›²ç«¯å€‹äººåŒ–ç¨‹å¼äº¤æ˜“å„€è¡¨æ¿ã€‹ï¼Œå¸Œæœ›å¯ä»¥é€éŽå…è²»ã€å¯ä¾›å®¢è£½åŒ–ä¸”å¯¦å‹™ä¸Šå¯è¡Œæ€§é«˜çš„å„€è¡¨æ¿æä¾›æŠ•è³‡äººä½œç‚ºå»ºè­°ï¼ŒçµåˆGoogle Financeç²å–ä¸åŒä¸Šå¸‚å…¬å¸ä¹‹è³‡æ–™ï¼Œä½¿ç”¨äººå·¥æ™ºæ…§å¥—ä»¶BigMLå»ºç«‹ç·šæ€§å›žæ­¸æ¨¡åž‹ï¼Œç•«å‡ºäº”ç·šè­œã€æ¨‚æ´»é€šé“ï¼Œå†åˆ©ç”¨Pythonè¨ˆç®—å‡ºå„é …æŠ€è¡“æŒ‡æ¨™åŠå ±é…¬çŽ‡(SMAã€KDã€å¸ƒæž—é€šé“ç­‰)ã€‚ç¨‹å¼èªžè¨€çš„è­‰ç…§æ–¹é¢ï¼Œè€ƒå–TQC+ç¨‹å¼èªžè¨€Python3 èˆ‡ TQC+ç¶²é è³‡æ–™æ“·å–èˆ‡åˆ†æžè­‰ç…§ï¼Œå¸Œæœ›è‡ªå·±èƒ½é€éŽé€™äº›è­‰ç…§ä¾†è­‰æ˜Žè‡ªå·±çš„æŠ€èƒ½ã€‚ 
  åœ¨å¤§å­¸ç•¢æ¥­å‰æˆ‘å°±å·²ç¶“æ‹¿åˆ°ä»å¯¶é›»è…¦-æ¸¬è©¦è‡ªå‹•åŒ–å·¥ç¨‹å¸«çš„offerï¼Œç•¢æ¥­å³å°±æ¥­ã€‚ä¸»è¦å·¥ä½œå…§å®¹åŒ…å«:æ’°å¯«å…¬å¸å…§éƒ¨ç¶²é èˆ‡ç·šä¸ŠåŒ–è³‡æ–™åº«ç³»çµ±(è² è²¬å‰ç«¯ï¼Œä½¿ç”¨Vueæž¶æ§‹)ã€æ’°å¯«è‡ªå‹•åŒ–è»Ÿé«”Tool(ä¸»è¦ä½¿ç”¨Python)ã€å”åŠ©å°ˆæ¡ˆå–å¾—Intel evoèªè­‰ã€å°ˆæ¡ˆä½¿ç”¨è€…é«”é©—ã€ç­†é›»æ•ˆèƒ½æ¸¬è©¦ç­‰ï¼Œä¹ŸæŽ¥è§¸åˆ°æ•¸æ“šåˆ†æžã€ç¶²è·¯çˆ¬èŸ²ä»¥åŠDjangoå¾Œç«¯æ‡‰ç”¨ï¼Œåœ¨å·¥ä½œçš„éŽç¨‹ä¸­ä¹ŸæŽ¥è§¸åˆ°å°ˆæ¡ˆç®¡ç†ï¼Œäº†è§£åˆ°ç®¡ç†å°æ–¼å°ˆæ¡ˆé€²è¡Œçš„é‡è¦æ€§ã€‚
  åœ¨ä»å¯¶é›»è…¦æ“”ä»»RDéƒ¨é–€å·¥ç¨‹å¸«ä¸€å¹´å¤šï¼Œç™¼ç¾è‡ªå·±ç¢ºå¯¦æœ‰å°è»Ÿé«”ç ”ç™¼çš„ç†±æ„›èˆ‡èƒ½åŠ›ï¼Œä½†åŒæ™‚æ±‚çŸ¥è‹¥æ¸´çš„æˆ‘å¸Œæœ›å¯ä»¥å­¸ç¿’æ›´å¤šAIé ˜åŸŸç›¸é—œçŸ¥è­˜ï¼Œç¶“éŽä¸æ–·æŽ™æ‰Žä¸‹é‚„æ˜¯æ±ºå®šå…ˆé›¢è·é€²ä¿®ï¼Œé€²å…¥äº†å…ƒæ™ºå¤§å­¸è³‡è¨Šç®¡ç†å­¸ç³»ç¢©å£«ç­é€²ä¿®ã€‚
  é€éŽä»å¯¶é›»è…¦ä¸»ç®¡çš„å¼•è–¦ä¸‹ï¼Œæˆ‘ä¾†åˆ°å…ƒæ™ºå¤§å­¸è³‡è¨Šç®¡ç†å­¸ç³»ç¢©å£«ç­å°±è®€ï¼Œä¸¦é€²å…¥äº†è©¹å‰éš†é™¢é•·æŒ‡å°Žçš„æ”¯æ´æ±ºç­–å¯¦é©—å®¤ï¼Œä¸»è¦ç ”ç©¶æ–¹å‘ç‚º:é†«ç™‚å½±åƒè¾¨è­˜ã€AIæ·±åº¦å­¸ç¿’ï¼Œä¸»è¦ä½¿ç”¨ TensorFlow/ Keras ç­‰ï¼Œæˆ‘ä¹Ÿå°æ­¤æ–¹é¢ç›¸ç•¶æœ‰ç†±å¿±ï¼ŒçŸ¥è­˜ä»¥å¤–ä¹Ÿå­¸åˆ°äº†å¦‚ä½•è‡ªä¸»å­¸ç¿’çš„æ–¹æ³•ã€é–±è®€æ–‡ç»ã€è‹±æ–‡å ±å‘Šã€æºé€šè¡¨é”çš„èƒ½åŠ›ã€‚(è«–æ–‡æ˜¯è¦–ç¶²è†œè¡€ç®¡ã€è¦–ç›¤çš„Segmentation)
  åœ¨å­¸æœŸé–“æˆ‘çš„å…©ä½å¤§å­¸åŒå­¸çŸ¥é“æˆ‘åœ¨åšå½±åƒè¾¨è­˜ç›¸é—œç ”ç©¶ï¼Œæ–¼æ˜¯é‚€è«‹æˆ‘ä¸€åŒå ±åå…¨åœ‹AIå½±åƒè¾¨è­˜ç«¶è³½(æ™ºæ³°ç§‘æŠ€å”è¾¦)ï¼Œè©²ç«¶è³½è¦–ä½¿ç”¨ VisLab è»Ÿé«”é€²è¡Œåœ–ç‰‡çš„æ¨™è¨˜ã€ä½¿ç”¨æ¨¡åž‹èˆ‡èª¿æ•´å„å€‹é è™•ç†èˆ‡æ©Ÿå™¨å­¸ç¿’åƒæ•¸ï¼Œä»¥ç²å¾—æœ€å¥½çš„é æ¸¬çµæžœç‚ºç›®çš„ï¼Œé€éŽä¸æ–·çš„è¨Žè«–èˆ‡äº’ç›¸å­¸ç¿’ã€å˜—è©¦ï¼Œæœ€çµ‚æˆ‘å€‘ç²å¾—äº†å¤§å°ˆé™¢æ ¡çµ„å­£è»çš„æˆç¸¾ã€‚
  åœ¨ç¢©å£«åœ¨å­¸æœŸé–“ï¼Œæˆ‘åƒèˆ‡äº†æ•¸ç™¼éƒ¨çš„è¨ˆç•«ï¼Œé€²å…¥æ–°å…‰é‡‘æŽ§çš„æ•¸ä½æ•¸æ“šæš¨ç§‘æŠ€ç™¼å±•éƒ¨é–€å¯¦ç¿’ï¼Œå°ˆæ¡ˆä¸»é¡Œç‚ºLLMåœ¨é‡‘èžç”¢æ¥­çš„æ‡‰ç”¨(ä¸­å°ä¼é‡‘å¾µæŽˆä¿¡æ™ºèƒ½åŠ©ç†å°ˆæ¡ˆ)ï¼Œå­¸ç¿’åˆ°äº†å¤§èªžè¨€æ¨¡åž‹çš„ç³»çµ±å»ºç½®(é”å“¥å¹³å°)èˆ‡è»Ÿé«”ç³»çµ±æž¶æ§‹è¨­è¨ˆï¼Œå› ç‚ºæˆ‘æœ¬èº«å…·æœ‰å‰ç«¯ç¶²é è¨­è¨ˆç¶“é©—ï¼Œæ‰€ä»¥å–®ä½ä¸»ç®¡ç›´æŽ¥å°‡å°ˆæ¡ˆçš„å‰ç«¯ç¶²é äº¤çµ¦æˆ‘å…¨æ¬Šè² è²¬ï¼Œæˆ‘ä¹Ÿæœ‰å”åŠ©å¯«å¹¾å€‹API(ä½¿ç”¨FastAPIæž¶æ§‹)ã€å¹«å¿™Azureè³‡æ–™åº«å»ºç½®ã€‚åœ¨æ–°å…‰è£¡é¢ï¼Œæˆ‘äº†è§£åˆ°é‡‘èžæ¥­èˆ‡ç§‘æŠ€æ¥­çš„æ–‡åŒ–ä¸åŒï¼Œé€™è£¡PMéƒ½ç”¨æ•æ·ç®¡ç†ä¾†é€²è¡Œå°ˆæ¡ˆé€²åº¦ç®¡æŽ§ï¼Œé™¤äº†æŽ¥è§¸åˆ°æ™‚ä¸‹æœ€æµè¡Œçš„LLMç³»çµ±é–‹ç™¼å¤–ï¼Œä¹Ÿé«”é©—åˆ°äº†èˆ‡ä¸åŒå·¥ä½œçš„å·¥ç¨‹å¸«åˆä½œæ™‚(å¦‚å¾Œç«¯ã€AI)ï¼Œæºé€šèˆ‡è‡ªå­¸èƒ½åŠ›æ˜¯å¾ˆé‡è¦çš„ã€‚
  ç”±æ–¼åœ¨æ–°å…‰æ™‚æŽ¥è§¸åˆ°Azureé›²ç«¯ç³»çµ±çš„æ‡‰ç”¨ï¼Œæ‰€ä»¥è¶æ­¤æ©Ÿæœƒæˆ‘æŠŠå¾®è»ŸAureè­‰ç…§ AI900(äººå·¥æ™ºæ…§)ã€DP900(è³‡æ–™ç§‘å­¸)éƒ½æ‹¿åˆ°äº†ï¼Œé›²ç«¯ç³»çµ±æ˜¯æœªä¾†çš„è¶¨å‹¢ï¼Œæ‰€ä»¥æœ‰æŽ¥è§¸çš„ç¶“é©—æ™‚è¦å¥½å¥½æŠŠæ¡å­¸ç¿’çš„æ©Ÿæœƒã€‚
  æˆ‘å°‡æ–¼7æœˆç•¢æ¥­ï¼Œå¸Œæœ›æ‰¾åˆ°è»Ÿé«”å·¥ç¨‹å¸«è·ç¼ºï¼Œæˆ‘æ“æœ‰å¤§å¤šæ•¸å·¥ç¨‹å¸«è¼ƒç¼ºå°‘çš„æºé€šèƒ½åŠ›èˆ‡ç®¡ç†èƒ½åŠ›ï¼Œè€Œå°ˆæ¥­æŠ€èƒ½æ–¹é¢ä¹Ÿæ˜¯é™¸çºŒå°‡è‡ªå·±çš„æŠ€èƒ½æ¨¹é»žæ»¿èˆ‡ç²¾é€²ç•¶ä¸­ï¼Œé€™é»žä¸ç®¡æ˜¯å‰ä¸»ç®¡æˆ–æ˜¯æŒ‡å°Žæ•™æŽˆéƒ½å°æˆ‘è®šè­½æœ‰åŠ ï¼Œå“è³ªæŽ›ä¿è­‰!
  `;

  try {
    const response = await openai.chat.completions.create({
      model: "gpt-3.5-turbo", // æˆ–æ”¹æˆ gpt-4
      messages: [
        { role: "system", content: systemPrompt },
        { role: "user", content: userInput }
      ]
    });

    const reply = response.choices[0].message.content;
    res.json({ message: { content: reply } });
  } catch (err) {
    console.error("OpenAI API éŒ¯èª¤ï¼š", err);
    res.status(500).json({ error: "å¾Œç«¯è™•ç†éŒ¯èª¤" });
  }
});

app.listen(port, () => {
  console.log(`âœ… Server is running on http://localhost:${port}`);
});

// é…ç½®è·¯ç”±
app.get('/', (req, res) => {
  res.send('Hello World!');
});
